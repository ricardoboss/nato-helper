<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NATO Phonetic Trainer</title>
  <style>
    :root {
      color-scheme: light dark;
      --font-family: "Inter", "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      --background: #f2f5fa;
      --background-accent: radial-gradient(120% 120% at 0% 0%, rgba(37, 99, 235, 0.12) 0, rgba(59, 130, 246, 0) 55%),
        radial-gradient(120% 120% at 100% 0%, rgba(14, 165, 233, 0.1) 0, rgba(14, 165, 233, 0) 55%);
      --surface: rgba(255, 255, 255, 0.85);
      --surface-strong: rgba(255, 255, 255, 0.92);
      --text: #0f172a;
      --text-muted: #475569;
      --border: rgba(15, 23, 42, 0.08);
      --shadow-lg: 0 30px 60px rgba(15, 23, 42, 0.15);
      --shadow-md: 0 16px 40px rgba(15, 23, 42, 0.12);
      --primary: #2563eb;
      --primary-hover: #1d4ed8;
      --primary-soft: rgba(37, 99, 235, 0.12);
      --primary-contrast: #ffffff;
      --success: #16a34a;
      --success-soft: rgba(22, 163, 74, 0.14);
      --error: #dc2626;
      --error-soft: rgba(220, 38, 38, 0.14);
      --warning: #f59e0b;
      --warning-soft: rgba(245, 158, 11, 0.16);
      --info: #0891b2;
      --info-soft: rgba(8, 145, 178, 0.14);
      --radius-lg: 24px;
      --radius-md: 16px;
      --radius-sm: 12px;
      --transition: 200ms ease;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --background: #0b1220;
        --background-accent: radial-gradient(120% 120% at 0% 0%, rgba(37, 99, 235, 0.22) 0, rgba(37, 99, 235, 0) 55%),
          radial-gradient(120% 120% at 100% 0%, rgba(14, 165, 233, 0.2) 0, rgba(14, 165, 233, 0) 55%);
        --surface: rgba(15, 23, 42, 0.7);
        --surface-strong: rgba(15, 23, 42, 0.85);
        --text: #e2e8f0;
        --text-muted: #94a3b8;
        --border: rgba(148, 163, 184, 0.25);
        --shadow-lg: 0 40px 70px rgba(0, 0, 0, 0.45);
        --shadow-md: 0 24px 45px rgba(2, 6, 23, 0.45);
        --primary-soft: rgba(59, 130, 246, 0.25);
        --success: #34d399;
        --success-soft: rgba(52, 211, 153, 0.16);
        --error: #f87171;
        --error-soft: rgba(248, 113, 113, 0.16);
        --warning: #fbbf24;
        --warning-soft: rgba(251, 191, 36, 0.2);
        --info: #22d3ee;
        --info-soft: rgba(34, 211, 238, 0.18);
      }
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: var(--font-family);
      background: var(--background);
      color: var(--text);
      display: flex;
      justify-content: center;
      padding: clamp(2rem, 4vw, 4rem);
      position: relative;
    }

    body::before {
      content: "";
      position: fixed;
      inset: 0;
      pointer-events: none;
      background: var(--background-accent);
      opacity: 0.95;
      z-index: -1;
    }

    main.app {
      width: min(1080px, 100%);
      position: relative;
      display: flex;
      flex-direction: column;
      gap: 2.5rem;
    }

    h1,
    h2,
    h3 {
      margin: 0;
      font-weight: 700;
      letter-spacing: -0.02em;
    }

    h1 {
      font-size: clamp(2.25rem, 2.75vw + 1.5rem, 3rem);
    }

    h2 {
      font-size: clamp(1.4rem, 1.3vw + 1.2rem, 1.8rem);
    }

    h3 {
      font-size: 1.1rem;
    }

    p {
      margin: 0;
      line-height: 1.6;
      color: var(--text-muted);
    }

    a {
      color: inherit;
    }

    .app-header {
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
    }

    .eyebrow {
      font-size: 0.75rem;
      letter-spacing: 0.25em;
      text-transform: uppercase;
      font-weight: 600;
      color: var(--primary);
    }

    .lede {
      font-size: 1.05rem;
      max-width: 60ch;
    }

    .status-pill {
      align-self: flex-start;
      border-radius: 999px;
      padding: 0.45rem 0.85rem;
      font-size: 0.75rem;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      transition: background var(--transition), color var(--transition);
    }

    .status-pill.is-loading {
      background: var(--warning-soft);
      color: var(--warning);
    }

    .status-pill.is-ready {
      background: var(--primary-soft);
      color: var(--primary);
    }

    .status-pill.is-error {
      background: var(--error-soft);
      color: var(--error);
    }

    .alert-region {
      position: relative;
    }

    .alert {
      display: flex;
      align-items: flex-start;
      gap: 1rem;
      padding: 1rem 1.25rem;
      border-radius: var(--radius-md);
      border: 1px solid transparent;
      background: var(--error-soft);
      color: var(--error);
      box-shadow: var(--shadow-md);
      transition: transform var(--transition), opacity var(--transition);
    }

    .alert[hidden] {
      display: none !important;
    }

    .alert.is-error {
      background: var(--error-soft);
      color: var(--error);
    }

    .alert.is-info {
      background: var(--info-soft);
      color: var(--info);
    }

    .alert.is-success {
      background: var(--success-soft);
      color: var(--success);
    }

    .alert.is-warning {
      background: var(--warning-soft);
      color: var(--warning);
    }

    .alert .alert-title {
      display: block;
      font-size: 0.95rem;
      font-weight: 700;
      margin-bottom: 0.25rem;
      color: inherit;
    }

    .alert .alert-content {
      flex: 1;
      min-width: 0;
    }

    .btn-icon {
      border: none;
      background: transparent;
      color: inherit;
      padding: 0.25rem;
      border-radius: 999px;
      cursor: pointer;
      transition: background var(--transition), transform var(--transition);
    }

    .btn-icon:hover {
      background: rgba(255, 255, 255, 0.08);
      transform: scale(1.05);
    }

    .mode-grid {
      display: grid;
      gap: 1.5rem;
    }

    @media (min-width: 900px) {
      .mode-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    .panel {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: clamp(1.5rem, 2vw, 2rem);
      box-shadow: var(--shadow-lg);
      backdrop-filter: blur(18px);
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
    }

    .panel.slim {
      gap: 1rem;
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 1rem;
    }

    .panel-header .panel-description {
      margin-top: 0.5rem;
    }

    .badge {
      align-self: flex-start;
      padding: 0.35rem 0.75rem;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      background: var(--primary-soft);
      color: var(--primary);
      border: 1px solid transparent;
    }

    .badge-neutral {
      background: var(--info-soft);
      color: var(--info);
    }

    .panel-body {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .field-label {
      font-size: 0.85rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
    }

    .input {
      width: 100%;
      padding: 0.85rem 1rem;
      border-radius: var(--radius-md);
      border: 1px solid var(--border);
      background: var(--surface-strong);
      color: var(--text);
      font-size: 1rem;
      transition: border var(--transition), box-shadow var(--transition), transform var(--transition);
    }

    .input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 4px var(--primary-soft);
      outline: none;
    }

    .input:disabled {
      opacity: 0.65;
      cursor: not-allowed;
    }

    .button-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
    }

    .btn {
      border: none;
      border-radius: var(--radius-md);
      font-weight: 600;
      padding: 0.75rem 1.25rem;
      cursor: pointer;
      transition: background var(--transition), color var(--transition), transform var(--transition), border var(--transition);
      font-size: 0.95rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .btn-primary {
      background: var(--primary);
      color: var(--primary-contrast);
      box-shadow: 0 10px 24px rgba(37, 99, 235, 0.28);
    }

    .btn-primary:hover {
      background: var(--primary-hover);
      transform: translateY(-1px);
    }

    .btn-secondary {
      background: var(--surface-strong);
      color: var(--text);
      border: 1px solid var(--border);
    }

    .btn-secondary:hover {
      border-color: var(--primary);
      color: var(--primary);
    }

    .btn-ghost {
      background: transparent;
      color: var(--text-muted);
      border: 1px solid transparent;
    }

    .btn-ghost:hover {
      color: var(--primary);
      background: var(--primary-soft);
    }

    .btn:disabled,
    .btn:disabled:hover {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .slider {
      width: 100%;
      height: 4px;
      border-radius: 999px;
      background: linear-gradient(90deg, var(--primary) 0%, rgba(37, 99, 235, 0.3) 100%);
      outline: none;
      transition: opacity var(--transition);
      appearance: none;
    }

    .slider:disabled {
      opacity: 0.5;
    }

    .slider::-webkit-slider-thumb {
      appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--primary);
      border: 3px solid var(--surface-strong);
      box-shadow: 0 10px 18px rgba(37, 99, 235, 0.25);
      cursor: pointer;
    }

    .slider::-moz-range-thumb {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--primary);
      border: 3px solid var(--surface-strong);
      box-shadow: 0 10px 18px rgba(37, 99, 235, 0.25);
      cursor: pointer;
    }

    .callout {
      padding: 0.85rem 1rem;
      border-radius: var(--radius-md);
      background: var(--surface-strong);
      border: 1px solid var(--border);
      color: var(--text);
      font-weight: 500;
    }

    .status {
      margin-top: 0.5rem;
      padding: 0.85rem 1rem;
      border-radius: var(--radius-md);
      background: var(--primary-soft);
      color: var(--primary);
      font-weight: 600;
      border: 1px solid transparent;
    }

    .status[hidden] {
      display: none !important;
    }

    .status.is-success {
      background: var(--success-soft);
      color: var(--success);
    }

    .status.is-error {
      background: var(--error-soft);
      color: var(--error);
    }

    .status.is-info {
      background: var(--info-soft);
      color: var(--info);
    }

    .status.is-warning {
      background: var(--warning-soft);
      color: var(--warning);
    }

    .recognized {
      font-family: "JetBrains Mono", "SFMono-Regular", Menlo, monospace;
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .recognized[hidden] {
      display: none !important;
    }

    .utility-panels {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .alphabet-panel {
      display: grid;
      gap: 0.75rem;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    }

    .alphabet-panel[hidden] {
      display: none !important;
    }

    .alphabet-cell {
      padding: 0.75rem 1rem;
      border-radius: var(--radius-md);
      border: 1px solid var(--border);
      background: var(--surface-strong);
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: 600;
      color: var(--text);
    }

    .alphabet-cell span:first-child {
      font-size: 1.1rem;
    }

    .future-ready > h2 {
      font-size: clamp(1.5rem, 1.2vw + 1.2rem, 2rem);
    }

    .feature-grid {
      display: grid;
      gap: 1.25rem;
    }

    @media (min-width: 768px) {
      .feature-grid {
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }
    }

    .feature-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 1.25rem;
      box-shadow: var(--shadow-md);
      backdrop-filter: blur(16px);
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .feature-card p {
      color: var(--text-muted);
    }

    @media (max-width: 640px) {
      body {
        padding: 1.5rem;
      }

      .panel {
        padding: 1.25rem;
      }
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/annyang/2.6.1/annyang.min.js"></script>
</head>
<body>
  <main class="app">
    <header class="app-header">
      <div>
        <p class="eyebrow">Communication drills</p>
        <h1>NATO Phonetic Alphabet Trainer</h1>
        <p class="lede">Sharpen your ability to understand and speak the NATO alphabet through guided listening and speaking exercises.</p>
      </div>
      <span id="appStatus" class="status-pill is-loading">Loading word list…</span>
    </header>

    <section class="alert-region" aria-live="assertive" aria-atomic="true">
      <div id="globalAlert" class="alert is-error" role="alert" hidden>
        <div class="alert-content">
          <strong id="alertTitle" class="alert-title">Heads up</strong>
          <span id="alertMessage"></span>
        </div>
        <button type="button" class="btn-icon" aria-label="Dismiss alert" onclick="dismissAlert()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
    </section>

    <div class="mode-grid">
      <article class="panel">
        <header class="panel-header">
          <div>
            <h2>Listening mode</h2>
            <p class="panel-description">Hear a NATO-coded word and translate it back to plain text.</p>
          </div>
          <span class="badge">Audio drills</span>
        </header>
        <div class="panel-body">
          <label for="listenInput" class="field-label">Type the word you heard</label>
          <input id="listenInput" class="input" autocomplete="off" placeholder="Enter the plain word" data-requires-dictionary="true" />
          <div class="button-row">
            <button class="btn btn-primary" type="button" onclick="checkListeningAnswer()" data-requires-dictionary="true">Submit</button>
            <button class="btn btn-secondary" type="button" onclick="startListeningMode()" data-requires-dictionary="true">Next word</button>
            <button class="btn btn-ghost" type="button" onclick="speakWord()" data-requires-dictionary="true">Replay word</button>
          </div>
          <label for="rateSlider" class="field-label slider-label">Speaking speed</label>
          <input type="range" id="rateSlider" class="slider" min="0.5" max="2" step="0.1" value="1" data-requires-dictionary="true" />
          <p id="listenResult" class="status" hidden aria-live="polite"></p>
        </div>
      </article>

      <article class="panel">
        <header class="panel-header">
          <div>
            <h2>Speaking mode</h2>
            <p class="panel-description">Spell the highlighted word using the NATO alphabet.</p>
          </div>
          <span class="badge badge-neutral">Voice practice</span>
        </header>
        <div class="panel-body">
          <p class="callout">Spell this word: <strong id="speakWord">—</strong></p>
          <div class="button-row">
            <button class="btn btn-primary" type="button" onclick="startSpeechRecognition()" data-requires-dictionary="true">Start speaking</button>
            <button class="btn btn-secondary" type="button" onclick="startSpeakingMode()" data-requires-dictionary="true">Next word</button>
          </div>
          <p id="speakResult" class="status" hidden aria-live="polite"></p>
          <p id="recognized" class="recognized" hidden></p>
        </div>
      </article>
    </div>

    <section class="utility-panels">
      <article class="panel slim">
        <header class="panel-header">
          <div>
            <h2>Need a refresher?</h2>
            <p class="panel-description">Toggle the NATO alphabet reference while you practice.</p>
          </div>
          <button id="hintToggle" class="btn btn-secondary" type="button" onclick="toggleHint()" aria-expanded="false">Show alphabet</button>
        </header>
        <div id="hintPanel" class="alphabet-panel" hidden></div>
      </article>
    </section>
  </main>

  <script>
    const natoAlphabet = {
      A: "Alpha", B: "Bravo", C: "Charlie", D: "Delta", E: "Echo", F: "Foxtrot",
      G: "Golf", H: "Hotel", I: "India", J: "Juliett", K: "Kilo", L: "Lima",
      M: "Mike", N: "November", O: "Oscar", P: "Papa", Q: "Quebec", R: "Romeo",
      S: "Sierra", T: "Tango", U: "Uniform", V: "Victor", W: "Whiskey",
      X: "X-ray", Y: "Yankee", Z: "Zulu"
    };

    let dictionary = [];
    let currentListeningWord = "";
    let currentSpeakingWord = "";
    let currentUtterance = null;
    let alertTimeoutId;

    const gatedControls = document.querySelectorAll("[data-requires-dictionary]");

    function setControlsEnabled(enabled) {
      gatedControls.forEach(control => {
        control.disabled = !enabled;
      });
    }

    function updateAppStatus(message, variant = "ready") {
      const badge = document.getElementById("appStatus");
      if (!badge) return;
      badge.textContent = message;
      badge.className = `status-pill is-${variant}`;
    }

    function setStatus(element, message, variant = "info") {
      if (!element) return;
      element.textContent = message;
      element.className = `status is-${variant}`;
      element.removeAttribute("hidden");
    }

    function clearStatus(element) {
      if (!element) return;
      element.textContent = "";
      element.className = "status";
      element.setAttribute("hidden", "true");
    }

    function showAlert(message, variant = "error") {
      const alert = document.getElementById("globalAlert");
      const alertTitle = document.getElementById("alertTitle");
      const alertMessage = document.getElementById("alertMessage");
      if (!alert || !alertMessage || !alertTitle) return;

      const titles = {
        error: "Something went wrong",
        info: "FYI",
        success: "Success",
        warning: "Please check"
      };

      alertTitle.textContent = titles[variant] || "Notice";
      alertMessage.textContent = message;
      alert.className = `alert is-${variant}`;
      alert.removeAttribute("hidden");

      clearTimeout(alertTimeoutId);
      alertTimeoutId = setTimeout(() => {
        alert.setAttribute("hidden", "true");
      }, 6000);
    }

    function dismissAlert() {
      const alert = document.getElementById("globalAlert");
      if (alert) {
        alert.setAttribute("hidden", "true");
      }
      clearTimeout(alertTimeoutId);
    }

    async function loadDictionary() {
      updateAppStatus("Loading word list…", "loading");
      setControlsEnabled(false);

      try {
        const response = await fetch("https://raw.githubusercontent.com/dwyl/english-words/master/words_alpha.txt");
        if (!response.ok) {
          throw new Error("Request failed.");
        }
        const text = await response.text();
        dictionary = text
          .split("\n")
          .map(w => w.trim().toUpperCase())
          .filter(w => w.length >= 4 && w.length <= 8);

        if (dictionary.length === 0) {
          throw new Error("Dictionary returned no entries.");
        }

        updateAppStatus("Word list ready", "ready");
        setControlsEnabled(true);
        startSpeakingMode();
      } catch (err) {
        console.error(err);
        updateAppStatus("Dictionary unavailable", "error");
        showAlert("Failed to load the practice dictionary. Check your connection or try again later.", "error");
      }
    }

    function getRandomWord() {
      return dictionary[Math.floor(Math.random() * dictionary.length)];
    }

    function startListeningMode(autoplay = true) {
      if (dictionary.length === 0) return;

      currentListeningWord = getRandomWord();
      const input = document.getElementById("listenInput");
      const result = document.getElementById("listenResult");

      if (input) {
        input.value = "";
        input.focus();
      }
      clearStatus(result);

      if (autoplay) {
        speakWord();
      }
    }

    function speakWord() {
      if (dictionary.length === 0) return;

      if (!currentListeningWord) {
        startListeningMode();
        return;
      }

      const input = document.getElementById("listenInput");
      if (input) {
        input.focus();
      }

      const rateControl = document.getElementById("rateSlider");
      const rate = rateControl ? parseFloat(rateControl.value) || 1 : 1;
      const spoken = currentListeningWord.split("").map(ch => natoAlphabet[ch] || ch).join(" ");

      if (speechSynthesis.speaking) {
        speechSynthesis.cancel();
      }

      currentUtterance = new SpeechSynthesisUtterance(spoken);
      currentUtterance.rate = rate;
      speechSynthesis.speak(currentUtterance);
    }

    function checkListeningAnswer() {
      const input = document.getElementById("listenInput");
      const result = document.getElementById("listenResult");

      if (!input || !result) return;

      if (!currentListeningWord) {
        setStatus(result, "Tap “Next word” to generate a prompt.", "info");
        return;
      }

      const value = input.value.trim().toUpperCase();
      if (!value) {
        setStatus(result, "Enter your guess to check the answer.", "info");
        return;
      }

      if (value === currentListeningWord) {
        setStatus(result, "Correct! Great job.", "success");
      } else {
        setStatus(result, `Not quite. The word was ${currentListeningWord}.`, "error");
      }
    }

    function toggleHint() {
      const hintPanel = document.getElementById("hintPanel");
      const hintToggle = document.getElementById("hintToggle");
      if (!hintPanel || !hintToggle) {
        return;
      }

      const isHidden = hintPanel.hasAttribute("hidden");

      if (isHidden) {
        hintPanel.innerHTML = Object.entries(natoAlphabet)
          .map(([letter, word]) => `<div class="alphabet-cell"><span>${letter}</span><span>${word}</span></div>`)
          .join("");
        hintPanel.removeAttribute("hidden");
        hintToggle.textContent = "Hide alphabet";
        hintToggle.setAttribute("aria-expanded", "true");
      } else {
        hintPanel.setAttribute("hidden", "true");
        hintPanel.innerHTML = "";
        hintToggle.textContent = "Show alphabet";
        hintToggle.setAttribute("aria-expanded", "false");
      }
    }

    function startSpeakingMode() {
      if (dictionary.length === 0) return;

      currentSpeakingWord = getRandomWord();
      const speakWordTarget = document.getElementById("speakWord");
      const result = document.getElementById("speakResult");
      const recognized = document.getElementById("recognized");

      if (speakWordTarget) {
        speakWordTarget.textContent = currentSpeakingWord;
      }
      clearStatus(result);
      if (recognized) {
        recognized.textContent = "";
        recognized.setAttribute("hidden", "true");
      }
    }

    function startSpeechRecognition() {
      if (!annyang) {
        showAlert("Speech recognition is not available in this browser.", "warning");
        return;
      }

      const result = document.getElementById("speakResult");
      const recognized = document.getElementById("recognized");

      clearStatus(result);
      setStatus(result, "Listening…", "info");

      if (recognized) {
        recognized.textContent = "";
        recognized.setAttribute("hidden", "true");
      }

      annyang.removeCommands();

      annyang.addCallback("result", function (phrases) {
        if (!phrases || phrases.length === 0) {
          setStatus(result, "No speech detected. Try again.", "warning");
          return;
        }

        const transcript = phrases[0].toLowerCase();
        const heard = transcript
          .split(" ")
          .map(word => {
            const match = Object.entries(natoAlphabet).find(([, nato]) => nato.toLowerCase() === word);
            return match ? match[0] : "?";
          })
          .join("");

        if (recognized) {
          recognized.textContent = `Recognized: ${heard}`;
          recognized.removeAttribute("hidden");
        }

        if (heard === currentSpeakingWord) {
          setStatus(result, "Correct! Crystal clear.", "success");
        } else {
          setStatus(result, `You spelled ${heard || "…"}. Try again.`, "error");
        }
      });

      annyang.addCallback("error", function () {
        setStatus(result, "We couldn't hear that. Give it another go.", "warning");
      });

      annyang.start({ autoRestart: false, continuous: false });
    }

    loadDictionary();
  </script>
</body>
</html>
